<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="AI-powered time management and task planning assistant" />
  <meta name="theme-color" content="#5b8aa6" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="LSD" />
  <link rel="apple-touch-icon" href="img/icon-192.png" />
  <link rel="manifest" href="manifest.json" />
  
  <title>LSD | AI Time Manager</title>

  <link rel="stylesheet" href="style.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
  <!-- HEADER -->
  <header class="header">
    <button class="settings_bt" id="openDrawer" type="button" aria-label="–ú–µ–Ω—é">
      <img src="img/menu-icon.svg" alt="" />
    </button>

    

    <div class="buttons">

       <img src="img/tasks-app-svgrepo-com.svg" alt="">
      <button class="tab" id="navBtn" type="button">
       
        <span>–∑–∞–¥–∞—á–∏</span>
      </button>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <!-- SCREEN: HOME -->
    <section class="screen active" id="screen-home">
      <div class="LSD">
        <h1>LSD | AI Time Manager</h1>
      </div>

      <div class="name">
        <h1 id="user">...</h1>
      </div>

      <img src="img/messenger.png" alt="" class="chat-img" />
    </section>

    <!-- SCREEN: TASKS -->
    <section class="screen" id="screen-tasks">
      <!-- PROGRESS BAR WITH STATS -->
      <div class="tasksTopSection">
        <div class="pointsBar" id="pointsBar">
          <div class="pointsLeft">
            <div class="cup">üèÜ</div>
            <div class="pointsText">
              <div class="pointsTitle">–û—á–∫–∏</div>
              <div class="pointsValue" id="pointsValue">0</div>
            </div>
          </div>
        </div>

        <!-- PROGRESS BAR -->
        <div class="progressWidget" id="progressWidget">
          <div class="progressHeader">
            <h3>üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
            <span class="progressEmoji" id="progressEmoji">üìå</span>
          </div>
          <div class="progressBar">
            <div class="progressFill" id="progressFill" style="width: 0%;"></div>
            <span class="progressPercent" id="progressPercent">0%</span>
          </div>
          <div class="progressStats">
            <div class="statItem">
              <span class="statLabel">‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
              <span class="statValue" id="completedCount">0</span>
            </div>
            <div class="statItem">
              <span class="statLabel">üìã –û—Å—Ç–∞–ª–æ—Å—å</span>
              <span class="statValue" id="remainingCount">0</span>
            </div>
            <div class="statItem">
              <span class="statLabel">üìä –í—Å–µ–≥–æ</span>
              <span class="statValue" id="totalCount">0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- CHAT FILTER TABS -->
      <div class="tasksChatFilter">
        <button class="chatFilterBtn active" data-chat-id="all" type="button">
          üìã –í—Å–µ –∑–∞–¥–∞—á–∏
        </button>
        <div class="chatFilterScroll" id="chatFilterScroll"></div>
      </div>

      <!-- TASKS BOX -->
      <div class="tasksBox">
        <div class="tasksHeader">
          <h2 id="tasksTitle">–í—Å–µ –∑–∞–¥–∞—á–∏</h2>
          <button class="clearBtn" id="clearTasks" type="button">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>

        <ul class="tasksList" id="tasksList"></ul>
        <p class="tasksHint" id="tasksHint">–ó–∞–¥–∞—á–∏ –ø–æ—è–≤—è—Ç—Å—è —Ç—É—Ç –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π.</p>
      </div>
    </section>

    <!-- SCREEN: CHAT -->
    <section class="screen" id="screen-chat">
      <div class="chatTop">
        <div class="chatTitle">LSD | AI Time Manager</div>
      </div>

      <div class="chatMessages" id="chatMessages"></div>
      <div class="chatTyping" id="chatTyping" hidden>AI –ø–µ—á–∞—Ç–∞–µ—Ç‚Ä¶</div>
    </section>
  </main>

  <!-- PLAN BUTTON (fixed area) -->
  <div class="plan">
    <button class="plan_bt" id="planBtn" type="button" hidden>–°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω</button>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="poisk">
      <button class="plus" id="plusBtn" type="button" aria-label="–ü–ª—é—Å">
        <img src="img/plus-svgrepo-com.svg" alt="" />
      </button>

      <input id="prompt" type="text" placeholder="–°–ø—Ä–æ—Å–∏ LSD..." />

      <button class="search_bt" id="sendBtn" type="button" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
        <img src="img/search.svg" alt="" />
      </button>
    </div>
  </footer>

  <!-- DRAWER OVERLAY -->
  <div class="drawerOverlay" id="drawerOverlay"></div>

  <!-- LEFT DRAWER -->
  <aside class="drawer" id="settingsDrawer" aria-hidden="true">
    <div class="tgDrawerTop">
      <div class="tgDrawerTopRow">
        <img id="drawerAvatar" class="tgDrawerAvatar" src="img/Avatar.svg" alt="avatar" />

        <button class="tgThemeMiniBtn" id="themeMiniBtn" type="button" aria-label="–¢–µ–º–∞">
          üåô
        </button>
      </div>

      <div class="tgDrawerName" id="drawerName">User</div>
      <div class="tgDrawerPhone" id="drawerPhone">ID: ‚Äî</div>
    </div>

    <div class="tgMenu">
      <button class="tgMenuItem" id="menuProfile" type="button">
        <span class="tgMenuIcon">üë§</span>
        <span class="tgMenuText">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</span>
      </button>

 
    </div>

    <div class="tgHistoryBlock">
      <div class="tgHistoryHeader">
        <div class="tgHistoryTitle">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</div>
        <button class="tgHistoryClear" id="clearHistory" type="button">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>

      <div class="tgHistoryScroll" id="historyList"></div>
    </div>
  </aside>

  <!-- PROFILE MODAL -->
  <div class="profileOverlay" id="profileOverlay"></div>

  <section class="profileModal" id="profileModal" aria-hidden="true">
    <div class="profileHeader">
      <h2 class="profileTitle">–ü—Ä–æ—Ñ–∏–ª—å</h2>
      <button class="profileClose" id="closeProfile" type="button">‚úï</button>
    </div>

    <div class="profileAvatarWrap">
      <img id="profileAvatar" src="img/Avatar.svg" alt="avatar" />
      <div class="pass">
        <h2>–≤–µ—Ä—Å–∏—è : –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è</h2>
        <button type="button" id="upgradeBtn">–û–±–Ω–æ–≤–∏—Ç—å –ü–ª–∞–Ω</button>
      </div>
    </div>





    <div class="profileCard">
      <div class="field">
        <label>–ò–º—è</label>
        <input id="profileName" type="text" readonly />
      </div>

      <div class="field">
        <label>–í–æ–∑—Ä–∞—Å—Ç (–¥–ª—è AI, –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å)</label>
        <input id="profileAge" type="number" min="0" max="120" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 19" />
      </div>

      <div class="field">
        <label>–ü—Å–µ–≤–¥–æ–Ω–∏–º (–¥–ª—è AI)</label>
        <input id="profileNick" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∏–º–ø–∞–ø—É—Å–∏–∫" />
      </div>

      <div class="field">
        <label>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ–±–µ (–¥–ª—è AI)</label>
        <textarea id="profileBio" rows="3" placeholder="–ö–æ—Ä–æ—Ç–∫–æ: –∫—Ç–æ —Ç—ã, —á–µ–º –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è, –∫–∞–∫–∏–µ —Ü–µ–ª–∏..."></textarea>
      </div>
    </div>
  </section>

  <!-- AI MODAL -->
  <div class="aiOverlay" id="aiOverlay"></div>

  <section class="aiModal" id="aiModal" aria-hidden="true">
    <div class="aiModalHeader">
      <h2>–û—Ç–≤–µ—Ç LSD</h2>
      <button id="closeAi" type="button">‚úï</button>
    </div>
    <pre class="aiText" id="aiText"></pre>
  </section>

  <!-- PLAN MODAL -->
  <div class="planOverlay" id="planOverlay"></div>

  <section class="planModal" id="planModal" aria-hidden="true">
    <div class="planHeader">
      <h2>–ü–ª–∞–Ω</h2>
      <button id="closePlan" type="button">‚úï</button>
    </div>

    <div class="planContent" id="planContent"></div>
  </section>

  <!-- PLUS ATTACH MENU (Telegram-like) -->
<div class="attach" id="attach" aria-hidden="true">
  <div class="attach__panel" role="menu" aria-label="–í–ª–æ–∂–µ–Ω–∏—è">
    <!-- –§–æ—Ç–æ -->
    <label class="attach__item" role="menuitem">
      <span class="attach__icon" aria-hidden="true">üì∑</span>
      <span class="attach__text">–§–æ—Ç–æ</span>
      <input
        id="pickPhoto"
        class="attach__input"
        type="file"
        accept="image/*"
      />
    </label>

    <!-- –§–∞–π–ª -->
    <label class="attach__item" role="menuitem">
      <span class="attach__icon" aria-hidden="true">üìé</span>
      <span class="attach__text">–§–∞–π–ª</span>
      <input id="pickFile" class="attach__input" type="file" />
    </label>
  </div>
</div>


<!-- LSD Premium screen (standalone window like Telegram Premium) -->
<div id="screen-subscription" class="lsdPrem" aria-hidden="true">
  <div class="lsdPrem__inner">
    <!-- TOP -->
    <header class="lsdPrem__top">
      <button class="lsdPrem__back" id="subscriptionClose" type="button" aria-label="–ù–∞–∑–∞–¥">‚Üê</button>

      <div class="lsdPrem__hero">
        <div class="lsdPrem__logo" aria-hidden="true">
          <!-- star -->
         <img src="img/telegrammpremium.svg" alt="">
       
        </div>

        <h1 class="lsdPrem__title">LSD Premium</h1>
        <p class="lsdPrem__subtitle">
          –ë–æ–ª—å—à–µ —Å–≤–æ–±–æ–¥—ã –∏ —É–¥–æ–±—Å—Ç–≤–∞ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π LSD Premium.
        </p>
      </div>
    </header>

    <!-- CONTENT -->
    <main class="lsdPrem__content">
      <!-- PRICING CARD -->
      <section class="lsdPrem__payCard" aria-label="–¢–∞—Ä–∏—Ñ—ã">
        <label class="lsdPrem__payRow">
          <input type="radio" name="lsd_plan" value="year" checked />
          <span class="lsdPrem__radio"></span>

          <div class="lsdPrem__payMid">
            <div class="lsdPrem__payTitle">
              –ï–∂–µ–≥–æ–¥–Ω–æ <span class="lsdPrem__badge">-37%</span>
            </div>
          </div>

          <div class="lsdPrem__payRight">
            <div class="lsdPrem__payPrice">1990 ‚≠ê/–≥–æ–¥</div>
          </div>
        </label>

        <div class="lsdPrem__divider"></div>

        <label class="lsdPrem__payRow">
          <input type="radio" name="lsd_plan" value="month" />
          <span class="lsdPrem__radio"></span>

          <div class="lsdPrem__payMid">
            <div class="lsdPrem__payTitle">–ï–∂–µ–º–µ—Å—è—á–Ω–æ</div>
          </div>

          <div class="lsdPrem__payRight">
            <div class="lsdPrem__payPrice">199 ‚≠ê/–º–µ—Å</div>
          </div>
        </label>
      </section>

      <!-- BENEFITS -->
      <section class="lsdPrem__list" aria-label="–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞">

        <div class="lsdPrem__item">
          <div class="lsdPrem__ico" aria-hidden="true">üìé</div>
          <div class="lsdPrem__itemMid">
            <div class="lsdPrem__itemTitle">–§–∞–π–ª—ã –∏ —Ñ–æ—Ç–æ –≤ —á–∞—Ç</div>
            <div class="lsdPrem__itemText">
               –≤—ã –º–æ–∂–µ—Ç–µ —Å–∫–∏–¥—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ —Ñ–∞–π–ª–æ–≤ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ —á–∞—Ç
            </div>
          </div>
         
        </div>


        <div class="lsdPrem__item">
          <div class="lsdPrem__ico" aria-hidden="true">üß†</div>
          <div class="lsdPrem__itemMid">
            <div class="lsdPrem__itemTitle">–ü–∞–º—è—Ç—å –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç</div>
            <div class="lsdPrem__itemText">
               —É–ª—É—á—à–µ–Ω–Ω–∞—è –ø–∞–º—è—Ç—å –∏ –ª–æ–≥–∏–∫–∞ AI
            </div>
          </div>
          
        </div>

                <div class="lsdPrem__item">
          <div class="lsdPrem__ico" aria-hidden="true">üìã</div>
          <div class="lsdPrem__itemMid">
            <div class="lsdPrem__itemTitle">–±–æ–ª—å—à–µ –ø–ª–∞–æ–≤</div>
            <div class="lsdPrem__itemText">
               –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –±–æ–ª—å—à–µ –ø–ª–∞–Ω–æ–≤ –Ω–∞ –¥–µ–Ω—å
            </div>
          </div>
          
        </div>

                        <div class="lsdPrem__item">
          <div class="lsdPrem__ico" aria-hidden="true">üåé</div>
          <div class="lsdPrem__itemMid">
            <div class="lsdPrem__itemTitle">–°–∫–æ—Ä–æ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ !</div>
            <div class="lsdPrem__itemText">
               map-maind , —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ —á–∞—Ç—ã  
            </div>
          </div>
          
        </div>
      </section>

      <!-- CTA -->
      <div class="lsdPrem__ctaWrap">
        <button id="lsdSubscribeBtn" class="lsdPrem__cta" type="button">
          –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∑–∞ <span id="lsdCtaPrice">13 490 ‚Ç∏</span> –≤ –≥–æ–¥
        </button>
        <div class="lsdPrem__hint">–ü–æ–¥–ø–∏—Å–∫—É –º–æ–∂–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.</div>
      </div>
    </main>
  </div>
</div>


  <script defer>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PWA –∏ Service Worker
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("/sw.js")
          .then((reg) => {
            console.log("[PWA] Service Worker registered:", reg);
            
            reg.addEventListener("updatefound", () => {
              const newWorker = reg.installing;
              newWorker.addEventListener("statechange", () => {
                if (newWorker.state === "activated") {
                  console.log("[PWA] New Service Worker available");
                  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                  const updateBanner = document.createElement("div");
                  updateBanner.className = "updateBanner";
                  updateBanner.innerHTML = `
                    <p>–î–æ—Å—Ç—É–ø–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
                    <button onclick="window.location.reload()">–û–±–Ω–æ–≤–∏—Ç—å</button>
                  `;
                  document.body.appendChild(updateBanner);
                }
              });
            });
          })
          .catch((err) => console.warn("[PWA] SW registration failed:", err));
      });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ offline/online
    window.addEventListener("online", () => {
      const banner = document.querySelector(".offlineBanner");
      if (banner) banner.remove();
      console.log("[App] Online");
    });

    window.addEventListener("offline", () => {
      const offline = document.createElement("div");
      offline.className = "offlineBanner";
      offline.innerHTML = `
        <div class="offlineContent">
          <span class="offlineIcon">üì°</span>
          <span class="offlineText">–í—ã –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ</span>
        </div>
      `;
      document.body.insertBefore(offline, document.body.firstChild);
      console.log("[App] Offline");
    });
  </script>

  <!-- –ú–æ–¥—É–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ JavaScript.js -->
  <script type="module">
    import { tgReady } from "./modules/utils.module.js";
    import { initEnhancedUX } from "./modules/ux.module.js";
    import { initGlobalErrorHandler } from "./modules/error.module.js";
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    tgReady();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
    initGlobalErrorHandler();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UX —É–ª—É—á—à–µ–Ω–∏–π
    initEnhancedUX();

    console.log("[App] Initialized with modular architecture");
  </script>

  <!-- –õ–æ–∞–¥–µ—Ä —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞ (–≤—Ä–µ–º–µ–Ω–Ω–æ, –ø–æ–∫–∞ –º–∏–≥—Ä–∏—Ä—É–µ–º) -->
  <script src="./JavaScript.js" defer></script>

  <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Progress & Tasks UI -->
  <script type="module" defer>
    import { updateProgressDisplay } from "./modules/progress.module.js";
    import { initTasksUI, updateFiltersOnChatChange } from "./modules/taskui.module.js";
    import { markTaskDone, clearAllTasks } from "./modules/tasks.module.js";

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    window.updateProgress = updateProgressDisplay;
    window.updateTasksUI = () => {
      const tasksList = document.getElementById("tasksList");
      if (tasksList) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π renderTasks –∏–∑ JavaScript.js
        if (window.renderTasks) window.renderTasks();
      }
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º UI –∑–∞–¥–∞—á –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener("load", () => {
      setTimeout(() => {
        initTasksUI(
          (groupId, itemIndex) => {
            markTaskDone(groupId, itemIndex);
            updateProgressDisplay();
            window.updateTasksUI();
          },
          () => {
            clearAllTasks();
            updateProgressDisplay();
            window.updateTasksUI();
          }
        );
      }, 500);
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á
    window.addEventListener("tasks-updated", () => {
      updateProgressDisplay();
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —á–∞—Ç–∞
    window.addEventListener("chat-changed", () => {
      updateFiltersOnChatChange();
    });

    console.log("[Task UI] Initialized");
  </script>
</body>
</html>
